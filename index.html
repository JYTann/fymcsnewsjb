<!DOCTYPE html>
<html lang="zh" data-theme="light">
<head>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-storage-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&family=Montserrat:wght@600;700&display=swap" rel="stylesheet">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>æ–°å±±å®½æŸ”ä¸­å­¦å¿«è®¯ç»„</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    /* CSS æ ·å¼éƒ¨åˆ† */
    footer {
      text-align: center;
      padding: 1.5rem;
      background: var(--color-primary);
      color: white;
      margin-top: auto;
      font-size: 0.9rem;
    }
    
    footer a {
      color: white;
      text-decoration: none;
      transition: opacity 0.2s;
    }
    
    footer a:hover {
      opacity: 0.8;
      text-decoration: underline;
    }
    
    .pinned {
      background: var(--color-accent);
      color: white;
    }
    
    .pinned-news {
      border: 2px solid var(--color-accent);
      position: relative;
      overflow: hidden;
    }

    .pinned-news::before {
      content: "ç½®é¡¶";
      position: absolute;
      top: 10px;
      right: -25px;
      background: var(--color-accent);
      color: white;
      padding: 2px 30px;
      transform: rotate(45deg);
      font-size: 12px;
      font-weight: bold;
    }

    :root {
      --color-bg: #f8f9fa;
      --color-text: #333333;
      --color-primary: #1a5276;
      --color-secondary: #2980b9;
      --color-accent: #e74c3c;
      --color-border: #e0e0e0;
      --color-card: #ffffff;
      --color-shadow: rgba(0,0,0,0.1);
      --color-meta: #7f8c8d;
      --color-success: #27ae60;
      --color-warning: #f39c12;
    }

    [data-theme="dark"] {
      --color-bg: #1a1a1a;
      --color-text: #f5f5f5;
      --color-primary: #4a90e2;
      --color-secondary: #5dade2;
      --color-accent: #e74c3c;
      --color-border: #444444;
      --color-card: #2d2d2d;
      --color-shadow: rgba(255,255,255,0.05);
      --color-meta: #aaaaaa;
      --color-success: #2ecc71;
      --color-warning: #f39c12;
    }

    * { 
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body { 
      font-family: 'Noto Sans SC', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--color-bg);
      color: var(--color-text);
      line-height: 1.6;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      transition: all 0.3s ease;
    }

    header {
      background: var(--color-primary);
      color: white;
      padding: 1rem;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem 1rem;
      flex: 1;
    }

    .card {
      background: var(--color-card);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 6px 15px var(--color-shadow);
      transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
      border: 1px solid var(--color-border);
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 20px var(--color-shadow);
    }

    header {
  background: linear-gradient(rgba(0, 0, 0, 0.5), url('https://i.postimg.cc/MZtgwDdY/2025-1.png');
  background-size: 200% 200%;
  animation: gradientBG 15s ease infinite;
}

@keyframes gradientBG {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}
    .clickable {
      cursor: pointer;
    }

    .btn {
      padding: 0.6rem 1.2rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      font-family: 'Noto Sans SC', sans-serif;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    .btn-primary {
      background: var(--color-primary);
      color: white;
    }

    .btn-primary:hover {
      background: var(--color-secondary);
    }

    .btn-secondary {
      background: var(--color-secondary);
      color: white;
    }

    .btn-secondary:hover {
      background: var(--color-primary);
    }

    .btn-danger {
      background: var(--color-accent);
      color: white;
    }

    .btn-danger:hover {
      background: #c0392b;
    }

    .btn-success {
      background: var(--color-success);
      color: white;
    }

    .btn-success:hover {
      background: #219653;
    }

    .btn-warning {
      background: var(--color-warning);
      color: white;
    }

    .btn-warning:hover {
      background: #e67e22;
    }

    .btn-outline {
      background: none;
      border: 2px solid var(--color-primary);
      color: var(--color-primary);
    }

    .btn-outline:hover {
      background: var(--color-primary);
      color: white;
    }

    .theme-toggle {
      position: absolute;
      right: 1rem;
      top: 1rem;
      background: none;
      border: none;
      cursor: pointer;
      padding: 0.5rem;
      border-radius: 50%;
      transition: all 0.3s ease;
      color: white;
    }

    .theme-toggle:hover {
      background: rgba(255,255,255,0.2);
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1200px;
      margin: 0 auto;
    }

    .logo-container {
      display: flex;
      align-items: center;
      gap: 1.5rem;
    }

    .header-logo {
      height: 60px;
      width: 60px;
      object-fit: contain;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
      transition: transform 0.3s ease;
    }

    .header-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: white;
    }

    .header-subtitle {
      font-size: 0.9rem;
      opacity: 0.9;
      color: rgba(255,255,255,0.8);
    }

    /* æ–°å¢å¤§æ ‡é¢˜æ ·å¼ */
.editor-title, .modal-title, .news-title {
  position: relative;
  padding-bottom: 0.75rem;
  margin-bottom: 1.5rem;
  color: var(--color-primary);
  font-weight: 700;
}

.editor-title:after, .modal-title:after, .news-title:after {
  content: "";
  position: absolute;
  bottom: 0;
  left: 0;
  width: 60px;
  height: 4px;
  background: linear-gradient(90deg, var(--color-primary), var(--color-secondary));
  border-radius: 2px;
}

/* å¸¦å›¾æ ‡æ ‡é¢˜çš„é¢å¤–æ ·å¼ */
.editor-title i, .modal-title i {
  margin-right: 0.8rem;
  font-size: 1.1em;
  color: var(--color-accent);
}

/* å¡ç‰‡æ ‡é¢˜æ ·å¼ */
.card-title {
  font-size: 1.4rem;
  font-weight: 600;
  margin-bottom: 1.5rem;
  color: var(--color-primary);
  display: flex;
  align-items: center;
  gap: 0.8rem;
  position: relative;
  padding-left: 1.2rem;
}

.card-title:before {
  content: "";
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 4px;
  background: linear-gradient(to bottom, var(--color-primary), var(--color-secondary));
  border-radius: 2px;
}

/* ç™»å½•æ ‡é¢˜ç‰¹æ®Šæ ·å¼ */
/* ä¿®æ”¹ç™»å½•æ ‡é¢˜æ ·å¼ */
#login .card h2 {
  font-family: 'Noto Sans SC', sans-serif;
  font-size: 2.2rem;
  font-weight: 700;
  text-align: center;
  margin: 0 auto 2rem;
  color: var(--login-title-color, #333); /* é»˜è®¤äº®è‰²ä¸»é¢˜é»‘è‰² */
  position: relative;
  padding-bottom: 1rem;
  transition: color 0.3s ease; /* æ·»åŠ é¢œè‰²è¿‡æ¸¡æ•ˆæœ */
}

/* æš—é»‘ä¸»é¢˜ä¸‹çš„é¢œè‰² */
[data-theme="dark"] #login .card h2 {
  color: #ffffff; /* æš—è‰²ä¸»é¢˜ç™½è‰² */
}


#login .card h2::after {
  content: "";
  position: absolute;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 80px;
  height: 3px;
  background: linear-gradient(90deg, 
    rgba(26, 82, 118, 0) 0%, 
    var(--color-accent) 50%, 
    rgba(26, 82, 118, 0) 100%);
  z-index: -1; /* ç¡®ä¿ä¸‹åˆ’çº¿åœ¨æ ‡é¢˜ä¸‹æ–¹ */
}

/* ç¡®ä¿æŒ‰é’®åŒºåŸŸæœ‰è¶³å¤Ÿçš„ç©ºé—´ */
#login .card .role-select {
  position: relative;
  z-index: 2; /* ç¡®ä¿æŒ‰é’®åœ¨æ ‡é¢˜ä¸Šæ–¹ */
  margin-top: 1.5rem; /* å¢åŠ ä¸Šè¾¹è· */
}

/* ç§»åŠ¨ç«¯é€‚é… */
@media (max-width: 768px) {
  #login .card h2 {
    font-size: 2rem;
    margin-bottom: 2rem;
    letter-spacing: 0.5px;
  }
}

/* æ·»åŠ å¡ç‰‡èƒŒæ™¯å¢å¼ºæ•ˆæœï¼ˆå¯é€‰ï¼‰ */
#login .card {
  background: var(--color-card);
  border-radius: 16px;
  box-shadow: 0 8px 30px rgba(0,0,0,0.12);
  border: 1px solid rgba(255,255,255,0.1);
  overflow: hidden;
  position: relative;
}

#login .card::before {
  content: "";
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
  z-index: 0;
}

/* ç§»åŠ¨ç«¯é€‚é… */
@media (max-width: 768px) {
  #login .card h2 {
    font-size: 1.8rem;
    padding: 0 1.5rem;
  }
  
  #login .card h2:before,
  #login .card h2:after {
    width: 30px;
  }
}

    .editor-toolbar {
      background: var(--color-bg);
      padding: 0.8rem;
      border-radius: 8px;
      margin: 1rem 0;
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      border: 1px solid var(--color-border);
    }

    #editor {
      min-height: 400px;
      border: 2px solid var(--color-border);
      border-radius: 8px;
      padding: 1.5rem;
      margin: 1rem 0;
      outline: none;
      background: var(--color-card);
      color: var(--color-text);
      font-size: 1rem;
      line-height: 1.8;
    }

    input[type="text"], textarea, select {
      width: 100%;
      padding: 0.8rem 1rem;
      border: 2px solid var(--color-border);
      border-radius: 8px;
      margin: 0.5rem 0;
      font-size: 1rem;
      transition: border-color 0.2s;
      background: var(--color-card);
      color: var(--color-text);
      font-family: 'Noto Sans SC', sans-serif;
    }

    input[type="text"]:focus, 
    textarea:focus,
    #editor:focus,
    select:focus {
      border-color: var(--color-primary);
      outline: none;
      box-shadow: 0 0 0 3px rgba(26, 82, 118, 0.2);
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .modal-content {
      background: var(--color-card);
      color: var(--color-text);
      padding: 2rem;
      border-radius: 12px;
      width: 90%;
      max-width: 500px;
      position: relative;
      box-shadow: 0 5px 20px rgba(0,0,0,0.2);
    }

    .modal-title {
      font-size: 1.5rem;
      margin-bottom: 1.5rem;
      color: var(--color-primary);
      font-weight: 600;
    }

    .news-meta {
      color: var(--color-meta);
      font-size: 0.9rem;
      margin: 0.5rem 0 1.5rem;
      display: flex;
      gap: 1.5rem;
    }

    .action-buttons {
      display: flex;
      gap: 0.8rem;
      margin-top: 1.5rem;
      flex-wrap: wrap;
    }

    .news-content img {
      max-width: 100%;
      height: auto;
      margin: 1.5rem 0;
      border-radius: 8px;
      box-shadow: 0 2px 8px var(--color-shadow);
    }

    .full-width {
      width: 100%;
      margin: 0.8rem 0;
    }

    .hidden {
      display: none !important;
    }

    .news-image {
      width: 100%;
      height: 300px;
      object-fit: cover;
      border-radius: 8px;
      margin-bottom: 1.5rem;
      box-shadow: 0 2px 8px var(--color-shadow);
    }

    .news-title {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 1rem;
      color: var(--color-primary);
      line-height: 1.3;
    }

    .news-excerpt {
      color: var(--color-meta);
      margin-bottom: 1rem;
      font-size: 1.1rem;
      flex-grow: 1;
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
    }

    .news-card {
      min-height: 200px;
      display: flex;
      flex-direction: column;
      transition: all 0.3s ease;
    }

    .news-card:hover {
      transform: translateY(-5px);
    }

    .news-card h3 {
      transition: color 0.2s;
    }

    .news-card:hover h3 {
      color: var(--color-primary);
    }

    .news-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 1.5rem;
      margin-top: 2rem;
    }

    .tool-btn {
      padding: 0.5rem 0.8rem;
      border: 1px solid var(--color-border);
      background: var(--color-card);
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 36px;
      height: 36px;
    }

    .tool-btn:hover {
      background: var(--color-bg);
    }

    .tool-btn.active {
      background: var(--color-primary);
      color: white;
      border-color: var(--color-primary);
    }

    .font-selector, .size-selector {
      padding: 0.5rem;
      border: 1px solid var(--color-border);
      border-radius: 6px;
      background: var(--color-card);
      color: var(--color-text);
      height: 36px;
    }

    .editor-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--color-border);
    }

    .editor-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--color-primary);
    }

    .share-buttons {
      display: flex;
      gap: 0.8rem;
      margin-top: 1.5rem;
      flex-wrap: wrap;
    }

    .share-btn {
      padding: 0.6rem 1rem;
      border-radius: 6px;
      color: white;
      text-decoration: none;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      transition: all 0.2s;
    }

    .share-section {
      margin-top: 2rem;
      padding: 1rem;
      background: var(--color-card);
      border-radius: 8px;
      border: 1px solid var(--color-border);
    }

    .share-section h3 {
      margin-bottom: 1rem;
      color: var(--color-primary);
    }

    .share-icons a {
      font-size: 1.2rem;
      opacity: 0.7;
      transition: all 0.2s;
    }

    .share-icons a:hover {
      opacity: 1;
      transform: translateY(-2px);
    }

    .news-footer {
      margin-top: auto;
    }

    .share-btn:hover {
      opacity: 0.9;
      transform: translateY(-2px);
    }

    .facebook {
      background: #3b5998;
    }

    .twitter {
      background: #1da1f2;
    }

    .whatsapp {
      background: #25d366;
    }

    .link {
      background: var(--color-secondary);
    }

    .back-btn {
      margin-bottom: 1.5rem;
    }

    .category-tag {
      display: inline-block;
      padding: 0.3rem 0.8rem;
      background: var(--color-secondary);
      color: white;
      border-radius: 20px;
      font-size: 0.8rem;
      margin-right: 0.5rem;
      margin-bottom: 0.5rem;
    }

    .category-selector {
      margin-bottom: 1rem;
    }

    .status-badge {
      display: inline-block;
      padding: 0.3rem 0.8rem;
      border-radius: 20px;
      font-size: 0.8rem;
      margin-left: 0.5rem;
    }

    .toast {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  padding: 12px 24px;
  border-radius: 8px;
  background: var(--color-card);
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  display: flex;
  align-items: center;
  gap: 8px;
  z-index: 1000;
  animation: slide-in 0.3s ease-out;
}

.toast-success {
  background: var(--color-success);
  color: white;
}

.toast-error {
  background: var(--color-accent);
  color: white;
}

.toast-info {
  background: var(--color-secondary);
  color: white;
}

.fade-out {
  animation: fade-out 0.5s ease-out forwards;
}

@keyframes slide-in {
  from { bottom: -50px; opacity: 0; }
  to { bottom: 20px; opacity: 1; }
}

@keyframes fade-out {
  from { opacity: 1; }
  to { opacity: 0; }
}

    .uploading {
  position: relative;
}

.uploading::after {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(255,255,255,0.8);
  z-index: 10;
}

.fa-spinner {
  animation: spin 1s linear infinite;
}

@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

    #newsSearchInput:focus {
  border-color: var(--color-primary);
  outline: none;
  box-shadow: 0 0 0 3px rgba(26, 82, 118, 0.15);
}


    /* æ–°å¢å°é¢æ»šåŠ¨æ ·å¼ */
.news-carousel {
  width: 100%;
  height: 400px;
  position: relative;
  border-radius: 12px;
  overflow: hidden;
  margin-bottom: 2rem;
  box-shadow: 0 4px 12px var(--color-shadow);
}

.carousel-slide {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  opacity: 0;
  transition: opacity 1s ease-in-out;
  background-size: cover;
  background-position: center;
  display: flex;
  flex-direction: column;
  justify-content: flex-end;
  padding: 2rem;
  color: white;
  text-shadow: 0 2px 4px rgba(0,0,0,0.5);
}

.carousel-slide.active {
  opacity: 1;
}

.carousel-content {
  background: rgba(0,0,0,0.6);
  padding: 1.5rem;
  border-radius: 8px;
  max-width: 80%;
}

.carousel-content h3 {
  font-size: 1.8rem;
  margin-bottom: 0.5rem;
}

.carousel-content p {
  margin-bottom: 0;
  font-size: 1rem;
  opacity: 0.9;
}

.carousel-nav {
  position: absolute;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 0.5rem;
  z-index: 10;
}

.carousel-dot {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background: rgba(255,255,255,0.5);
  cursor: pointer;
  transition: all 0.3s;
}

.carousel-dot.active {
  background: white;
  transform: scale(1.2);
}

.carousel-control {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background: rgba(0,0,0,0.5);
  color: white;
  border: none;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  z-index: 10;
  transition: all 0.3s;
}

.carousel-control:hover {
  background: rgba(0,0,0,0.8);
}

.carousel-prev {
  left: 20px;
}

.carousel-next {
  right: 20px;
}

/* å“åº”å¼è°ƒæ•´ */
@media (max-width: 768px) {
  .news-carousel {
    height: 300px;
  }
  
  .carousel-content {
    max-width: 100%;
    padding: 1rem;
  }
  
  .carousel-content h3 {
    font-size: 1.4rem;
  }
}

    .published {
      background: var(--color-success);
      color: white;
    }

    .draft {
      background: var(--color-warning);
      color: white;
    }

    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 200px;
    }

    .loading-spinner {
      border-width: 5px;
      border-top-color: var(--color-primary);
      border-right-color: var(--color-secondary);
      border-bottom-color: var(--color-accent);
      border-left-color: var(--color-success);
      animation: spin 1.5s linear infinite;
    }

    /* å°é¢å›¾ç‰‡ç½‘æ ¼å¸ƒå±€ */
.carousel-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  gap: 1rem;
  margin-bottom: 2rem;
}

/* ä¸Šä¼ åŒºåŸŸ */
.upload-section {
  border: 2px dashed var(--color-border);
  border-radius: 12px;
  padding: 2rem;
  text-align: center;
  transition: all 0.3s;
}

.upload-area {
  padding: 2rem;
  cursor: pointer;
}

.upload-area:hover {
  background: rgba(var(--color-primary-rgb), 0.05);
}

.upload-icon {
  font-size: 3rem;
  color: var(--color-primary);
  margin-bottom: 1rem;
}

.upload-meta {
  margin-top: 1rem;
  color: var(--color-meta);
  font-size: 0.9rem;
}

/* å›¾ç‰‡é¢„è§ˆå¡ç‰‡ */
.carousel-image-card {
  position: relative;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 3px 10px rgba(0,0,0,0.1);
  transition: transform 0.3s;
}

.carousel-image-card:hover {
  transform: translateY(-5px);
}

.carousel-image-preview {
  width: 100%;
  height: 180px;
  object-fit: cover;
}

.carousel-image-actions {
  position: absolute;
  top: 10px;
  right: 10px;
  display: flex;
  gap: 0.5rem;
}

/* æ‹–æ‹½æ•ˆæœ */
.drag-over {
  background: rgba(var(--color-primary-rgb), 0.1);
  border-color: var(--color-primary);
}

    /* æ–°å¢æµ®åŠ¨æ“ä½œæŒ‰é’® */
    .floating-action-btn {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: var(--color-primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      cursor: pointer;
      z-index: 99;
      transition: all 0.3s;
    }

    .floating-action-btn:hover {
      transform: translateY(-3px) scale(1.1);
      background: var(--color-secondary);
    }

    /* å°é¢å›¾ç‰‡ç®¡ç†æ ·å¼ */
.carousel-image-item {
  display: flex;
  align-items: center;
  padding: 1rem;
  border: 1px solid var(--color-border);
  border-radius: 8px;
  margin-bottom: 1rem;
  background: var(--color-card);
}

.carousel-image-preview {
  width: 150px;
  height: 100px;
  object-fit: cover;
  border-radius: 6px;
  margin-right: 1rem;
}

.carousel-image-actions {
  margin-left: auto;
  display: flex;
  gap: 0.5rem;
}

.carousel-image-url {
  flex-grow: 1;
  padding: 0.5rem;
  background: var(--color-bg);
  border: 1px solid var(--color-border);
  border-radius: 4px;
  font-family: monospace;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

    /* æ–°å¢åˆ†éš”çº¿æ ·å¼ */
    .divider {
      height: 1px;
      background: var(--color-border);
      margin: 1.5rem 0;
      opacity: 0.5;
    }

    /* æ–°å¢å¡ç‰‡æ ‡é¢˜æ ·å¼ */
    .card-title {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: var(--color-primary);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    /* æ–°å¢å°å·¥å…·æ ·å¼ */
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      padding: 0.3rem 0.6rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 500;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); opacity: 0.5; }
      50% { opacity: 1; }
      100% { transform: rotate(360deg); opacity: 0.5; }
    }

    @media (max-width: 768px) {

      .pinned-news::before {
        top: 5px;
        right: -30px;
        font-size: 10px;
      }
      
      .floating-action-btn {
        width: 50px;
        height: 50px;
        bottom: 20px;
        right: 20px;
        font-size: 20px;
      }

      .container {
        padding: 1rem;
      }
      
      .header-content {
        flex-direction: column;
        gap: 1rem;
        align-items: flex-start;
      }
      
      .header-logo {
        height: 50px;
        width: 50px;
      }
      
      .theme-toggle {
        position: static;
        margin-left: auto;
      }

      .news-grid {
        grid-template-columns: 1fr;
      }

      .action-buttons, .share-buttons {
        gap: 0.5rem;
      }

      .news-title {
        font-size: 1.5rem;
      }

      #editor {
        min-height: 300px;
        padding: 1rem;
      }

      /* è¯„è®ºåŒºåŸŸæ ·å¼ */
.comment-section {
  margin-top: 2.5rem;
  padding: 1.5rem;
  background: var(--color-card);
  border-radius: 12px;
  border: 1px solid var(--color-border);
  box-shadow: 0 2px 10px var(--color-shadow);
}

.comment-section h3 {
  color: var(--color-primary);
  margin-bottom: 1.5rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.comment-form {
  padding: 1.5rem;
  margin-bottom: 2rem;
}

.form-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
}

.form-header h4 {
  color: var(--color-primary);
  font-weight: 500;
}

.privacy-toggle {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.9rem;
  color: var(--color-meta);
}

/* åŒ¿ååˆ‡æ¢å¼€å…³æ ·å¼ */
.switch {
  position: relative;
  display: inline-block;
  width: 40px;
  height: 20px;
}

.switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #ccc;
  transition: .4s;
  border-radius: 34px;
}

.slider:before {
  position: absolute;
  content: "";
  height: 16px;
  width: 16px;
  left: 2px;
  bottom: 2px;
  background-color: white;
  transition: .4s;
  border-radius: 50%;
}

input:checked + .slider {
  background-color: var(--color-primary);
}

input:checked + .slider:before {
  transform: translateX(20px);
}

/* è¯„è®ºè¾“å…¥æ¡† */
.comment-form textarea {
  width: 100%;
  padding: 1rem;
  border: 1px solid var(--color-border);
  border-radius: 8px;
  margin-bottom: 1rem;
  resize: vertical;
  min-height: 100px;
  font-family: 'Noto Sans SC', sans-serif;
  transition: border-color 0.2s;
}

.comment-form textarea:focus {
  border-color: var(--color-primary);
  outline: none;
  box-shadow: 0 0 0 3px rgba(26, 82, 118, 0.1);
}

/* è¯„è®ºå‘å¸ƒåŒºåŸŸ */
.comment-meta {
  display: flex;
  gap: 0.8rem;
  align-items: center;
}

.name-input {
  flex: 1;
  padding: 0.8rem 1rem;
  border: 1px solid var(--color-border);
  border-radius: 8px;
  font-size: 0.9rem;
  transition: border-color 0.2s;
}

.name-input:focus {
  border-color: var(--color-primary);
  outline: none;
}

/* è¯„è®ºåˆ—è¡¨æ ·å¼ */
.comment-list {
  margin-top: 1.5rem;
}

.comment-item {
  padding: 1.2rem;
  margin-bottom: 1rem;
  background: var(--color-bg);
  border-radius: 10px;
  border: 1px solid var(--color-border);
}

.comment-author {
  font-weight: 600;
  color: var(--color-primary);
}

.comment-time {
  font-size: 0.8rem;
  color: var(--color-meta);
  margin-left: 0.8rem;
}

.comment-content {
  margin-top: 0.8rem;
  line-height: 1.6;
  color: var(--color-text);
}

.anonymous-badge {
  display: inline-block;
  padding: 0.2rem 0.5rem;
  background: var(--color-border);
  color: var(--color-meta);
  border-radius: 4px;
  font-size: 0.7rem;
  margin-left: 0.5rem;
}
      /* æ·»åŠ è¿‡æ¸¡åŠ¨ç”» */
.comment-item {
  transition: all 0.3s ease;
  opacity: 0;
  transform: translateY(10px);
  animation: fadeInUp 0.3s ease forwards;
}

@keyframes fadeInUp {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* ä¸ºæ¯ä¸ªè¯„è®ºé¡¹æ·»åŠ å»¶è¿ŸåŠ¨ç”» */
.comment-item:nth-child(1) { animation-delay: 0.1s; }
.comment-item:nth-child(2) { animation-delay: 0.2s; }
.comment-item:nth-child(3) { animation-delay: 0.3s; }
.comment-item:nth-child(4) { animation-delay: 0.4s; }
.comment-item:nth-child(5) { animation-delay: 0.5s; }

      /* æ·»åŠ åœ¨styleæ ‡ç­¾çš„æœ«å°¾ï¼Œåœ¨@mediaæŸ¥è¯¢ä¹‹å‰ */
.upload-label {
  display: block;
  margin-bottom: 0.5rem;
  font-weight: 500;
  color: var(--color-primary);
}

.upload-area:hover {
  background-color: rgba(var(--color-primary-rgb), 0.05);
  border-color: var(--color-primary) !important;
}

#imagePreview img {
  width: 100%;
  height: 100px;
  object-fit: cover;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  transition: transform 0.3s;
}

#imagePreview img:hover {
  transform: scale(1.03);
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

      @media (max-width: 768px) {
  .comment-meta {
    flex-direction: column;
    align-items: stretch;
  }
  
  .name-input {
    margin-bottom: 0.8rem;
  }
  
  .comment-form {
    padding: 1rem;
  }
  
  .comment-item {
    padding: 1rem;
  }
      }
    }
  </style>
</head>
<body>
  <!-- HTML ç»“æ„éƒ¨åˆ† -->
  <header>
    <link rel="icon" href="https://i.postimg.cc/qqV3NyJB/logo-01.png" type="image/png">
    <button class="theme-toggle">
      <i class="fas fa-moon"></i>
    </button>
    <div class="header-content">
      <div class="logo-container">
        <img src="https://i.postimg.cc/qqV3NyJB/logo-01.png" 
             alt="ç”µè„‘åä¼šLogo"
             class="header-logo">
        <div>
          <h1 class="header-title">æ–°å±±å®½æŸ”ä¸­å­¦ç”µè„‘åä¼š MICRO COMPUTER SOCIETY</h1>
          <p class="header-subtitle">åŠæ—¶ä¼ é€’å›½å†…å¤–ç§‘æŠ€èµ„è®¯ï¼ŒæœåŠ¡å¹¿å¤§å¸ˆç”Ÿ</p>
        </div>
      </div>
      <button id="logoutBtn" class="btn btn-outline hidden">ç™»å‡º</button>
    </div>
  </header>

  <div class="container">
  <!-- ç™»å½•ç•Œé¢ -->
  <section id="login">
    <div class="card">
      <h2 style="text-align: center; margin-bottom: 2rem;">ç³»ç»Ÿç™»å½•</h2>
      <div class="role-select" style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
        <button class="btn btn-primary" id="adminLoginBtn">
          <i class="fas fa-user-shield"></i> ç®¡ç†å‘˜ç™»å½•
        </button>
        <button class="btn btn-success" id="guestLoginBtn">
          <i class="fas fa-user"></i> è®¿å®¢æµè§ˆ
        </button>
      </div>
    </div>

    <!-- ä¸‰æ ¼è¯´æ˜åŒº -->
    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem; margin-top: 1.5rem;">
      <!-- æ ¼å­1ï¼šç®¡ç†å‘˜è¯´æ˜ -->
      <div class="card" style="padding: 1.5rem; text-align: center;">
        <div style="font-size: 2.5rem; color: var(--color-primary); margin-bottom: 1rem;">
          <i class="fas fa-key"></i>
        </div>
        <h3 style="margin-bottom: 0.5rem;">ç®¡ç†å‘˜</h3>
        <ul style="text-align: left; padding-left: 1.5rem; color: var(--color-meta);">
          <li>å‘å¸ƒ/ç¼–è¾‘æ–°é—»</li>
          <li>ç®¡ç†ç½®é¡¶å†…å®¹</li>
          <li>å®¡æ ¸ç³»ç»Ÿæ•°æ®</li>
        </ul>
      </div>

      <!-- æ ¼å­2ï¼šè®¿å®¢è¯´æ˜ -->
      <div class="card" style="padding: 1.5rem; text-align: center;">
        <div style="font-size: 2.5rem; color: var(--color-success); margin-bottom: 1rem;">
          <i class="fas fa-newspaper"></i>
        </div>
        <h3 style="margin-bottom: 0.5rem;">è®¿å®¢</h3>
        <ul style="text-align: left; padding-left: 1.5rem; color: var(--color-meta);">
          <li>æµè§ˆå…¬å¼€æ–°é—»</li>
          <li>æŸ¥çœ‹æ´»åŠ¨é¢„å‘Š</li>
          <li>æ— éœ€ç™»å½•</li>
        </ul>
      </div>

      <!-- æ ¼å­3ï¼šæŠ€æœ¯æ”¯æŒ -->
      <div class="card" style="padding: 1.5rem; text-align: center;">
        <div style="font-size: 2.5rem; color: var(--color-accent); margin-bottom: 1rem;">
          <i class="fas fa-code"></i>
        </div>
        <h3 style="margin-bottom: 0.5rem;">æŠ€æœ¯ä¿¡æ¯</h3>
        <ul style="text-align: left; padding-left: 1.5rem; color: var(--color-meta);">
          <li>è®¾è®¡ï¼šé™ˆä¿Šæº</li>
          <li>æŠ€æœ¯æ”¯æŒï¼šç”µè„‘åä¼š</li>
          <li>è”ç»œï¼štanjunyuanfoonyew@gmail.com</li>
        </ul>
      </div>
    </div>
  </section>
</div>

<!-- ç§»åŠ¨ç«¯é€‚é… -->
<style>
  @media (max-width: 768px) {
    #login > div[style*="grid-template-columns"] {
      grid-template-columns: 1fr !important;
    }
  }
</style>


    <!-- åå°ç®¡ç† -->
    <section id="dashboard" class="hidden">
      <div class="card">
        <div class="editor-header">
          <h2 class="editor-title"><i class="fas fa-newspaper"></i> å‘å¸ƒæ–°é—»</h2>
        </div>
        
        <input id="titleInput" type="text" placeholder="è¯·è¾“å…¥æ–°é—»æ ‡é¢˜" class="full-width" />
        
        <div class="category-selector">
          <select id="categorySelect" class="full-width">
            <option value="ç§‘æŠ€æ–°é—»">ç§‘æŠ€æ–°é—»</option>
            <option value="æ´»åŠ¨é¢„å‘Š">æ´»åŠ¨é¢„å‘Š</option>
            <option value="å­¦æœ¯åŠ¨æ€">å­¦æœ¯åŠ¨æ€</option>
            <option value="ä½“è‚²èµ›äº‹">ä½“è‚²èµ›äº‹</option>
            <option value="ç¤¾å›¢æ´»åŠ¨">ç¤¾å›¢æ´»åŠ¨</option>
          </select>
        </div>
        
        <div class="editor-toolbar">
          <select class="font-selector">
            <option value="'Noto Sans SC', sans-serif">é»˜è®¤å­—ä½“</option>
            <option value="'SimSun', serif">å®‹ä½“</option>
            <option value="'Microsoft YaHei', sans-serif">å¾®è½¯é›…é»‘</option>
            <option value="'KaiTi', serif">æ¥·ä½“</option>
          </select>
          
          <select class="size-selector">
            <option value="1">å°</option>
            <option value="3" selected>ä¸­</option>
            <option value="5">å¤§</option>
            <option value="7">ç‰¹å¤§</option>
          </select>
          
          <button class="tool-btn" title="åŠ ç²—">
            <i class="fas fa-bold"></i>
          </button>
          <button class="tool-btn" title="æ–œä½“">
            <i class="fas fa-italic"></i>
          </button>
          <button class="tool-btn" title="ä¸‹åˆ’çº¿">
            <i class="fas fa-underline"></i>
          </button>
          
          <button class="tool-btn" title="æ— åºåˆ—è¡¨">
            <i class="fas fa-list-ul"></i>
          </button>
          <button class="tool-btn" title="æœ‰åºåˆ—è¡¨">
            <i class="fas fa-list-ol"></i>
          </button>
          
          <button class="tool-btn" title="å·¦å¯¹é½">
            <i class="fas fa-align-left"></i>
          </button>
          <button class="tool-btn" title="å±…ä¸­å¯¹é½">
            <i class="fas fa-align-center"></i>
          </button>
          <button class="tool-btn" title="å³å¯¹é½">
            <i class="fas fa-align-right"></i>
          </button>
          
          <button class="tool-btn" title="æ’å…¥å›¾ç‰‡">
            <i class="fas fa-image"></i>
          </button>
          <input type="file" id="imageUpload" accept="image/*" style="display: none;">
          
          <button class="tool-btn" title="æ’å…¥é“¾æ¥">
            <i class="fas fa-link"></i>
          </button>
          <button class="tool-btn" title="ç§»é™¤é“¾æ¥">
            <i class="fas fa-unlink"></i>
          </button>
        </div>
        
        <div id="editor" contenteditable="true"></div>
        
        <div class="action-buttons">
          <button class="btn btn-success" id="draftBtn">
            <i class="fas fa-save"></i>
            ä¿å­˜è‰ç¨¿
          </button>
          <button class="btn btn-primary" id="publishBtn">
            <i class="fas fa-paper-plane"></i>
            å‘å¸ƒæ–°é—»
          </button>
        </div>
      </div>

      <!-- æ”¾åœ¨dashboardéƒ¨åˆ†çš„cardåé¢ -->
<div c<div class="card">
  <div class="editor-header">
    <h2 class="editor-title"><i class="fas fa-images"></i> å°é¢å›¾ç‰‡ç®¡ç†</h2>
  </div>
  
  <!-- å›¾ç‰‡åˆ—è¡¨å®¹å™¨ -->
  <div id="carouselImagesContainer" class="carousel-grid">
    <div class="loading">
      <div class="loading-spinner"></div>
    </div>
  </div>
  
  <!-- ä¸Šä¼ åŒºåŸŸ -->
  <div class="upload-section">
    <div class="upload-area" id="dropZone">
      <i class="fas fa-cloud-upload-alt upload-icon"></i>
      <h3>æ‹–æ”¾å›¾ç‰‡åˆ°æ­¤å¤„</h3>
      <p>æˆ–</p>
      <label for="carouselImageUpload" class="btn btn-outline">
        <i class="fas fa-folder-open"></i> é€‰æ‹©æ–‡ä»¶
      </label>
      <input type="file" id="carouselImageUpload" accept="image/*" style="display: none;">
    </div>
    
    <div class="upload-meta">
      <p><i class="fas fa-info-circle"></i> æ”¯æŒ JPG/PNG æ ¼å¼ï¼Œå»ºè®®å°ºå¯¸ 1200Ã—600px</p>
    </div>
    
    <div class="action-buttons">
      <button id="uploadCarouselImage" class="btn btn-primary" disabled>
        <i class="fas fa-upload"></i> å¼€å§‹ä¸Šä¼ 
      </button>
    </div>
  </div>
</div>

      <div class="card">
        <div class="editor-header">
          <h2 class="editor-title"><i class="fas fa-tasks"></i> æ–°é—»ç®¡ç†</h2>
          <div>
            <select id="newsFilter">
              <option value="all">å…¨éƒ¨æ–°é—»</option>
              <option value="published">å·²å‘å¸ƒ</option>
              <option value="drafts">è‰ç¨¿</option>
            </select>
          </div>
        </div>
        <div id="newsListAdmin">
          <div class="loading">
            <div class="loading-spinner"></div>
          </div>
        </div>

        <!-- æŠ•ç¨¿å®¡æ ¸ç®¡ç† -->
<section id="submissionReview" class="hidden">
  <div class="card">
    <div class="editor-header">
      <h2 class="editor-title"><i class="fas fa-inbox"></i> æŠ•ç¨¿å®¡æ ¸</h2>
    </div>
    <div id="submissionContainer">
      <div class="loading"><div class="loading-spinner"></div></div>
    </div>
  </div>
</section>

      </div>
    </section>

    <!-- æ–°é—»åˆ—è¡¨ -->
    <section id="newsList" class="hidden">
      <div class="card">
        <div class="editor-header">
          <h2 class="editor-title"><i class="fas fa-bell"></i> æœ€æ–°æ¶ˆæ¯</h2>
          <div style="margin-top: 1rem;">
            <button class="btn btn-success" onclick="showSubmissionForm()">
              <i class="fas fa-edit"></i> æˆ‘è¦æŠ•ç¨¿
            </button>
          </div>
          <div style="margin-top: 1rem; display: flex; gap: 1rem; flex-wrap: wrap; align-items: center;">
  <input 
    type="text" 
    id="newsSearchInput" 
    placeholder="ğŸ” è¾“å…¥å…³é”®è¯æœç´¢æ–°é—»..." 
    class="full-width" 
    style="
      flex: 1;
      padding: 0.75rem 1rem;
      font-size: 1rem;
      border-radius: 8px;
      border: 2px solid var(--color-border);
      background: var(--color-card);
      color: var(--color-text);
      transition: all 0.3s;
      box-shadow: 0 2px 6px var(--color-shadow);
    "
  />
</div>

          <div>
            <select id="categoryFilter">
              <option value="all">å…¨éƒ¨ç±»åˆ«</option>
              <option value="ç§‘æŠ€æ–°é—»">ç§‘æŠ€æ–°é—»</option>
              <option value="æ´»åŠ¨é¢„å‘Š">æ´»åŠ¨é¢„å‘Š</option>
              <option value="å­¦æœ¯åŠ¨æ€">å­¦æœ¯åŠ¨æ€</option>
              <option value="ä½“è‚²èµ›äº‹">ä½“è‚²èµ›äº‹</option>
              <option value="ç¤¾å›¢æ´»åŠ¨">ç¤¾å›¢æ´»åŠ¨</option>
            </select>
          </div>
        </div>
        <!-- å°é¢æ»šåŠ¨åŒºåŸŸ -->
<div class="news-carousel" id="newsCarousel">
  <!-- å¹»ç¯ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
  <button class="carousel-control carousel-prev">
    <i class="fas fa-chevron-left"></i>
  </button>
  <button class="carousel-control carousel-next">
    <i class="fas fa-chevron-right"></i>
  </button>
  <div class="carousel-nav"></div>
</div>
        <div class="news-grid" id="newsItems">
          <div class="loading">
            <div class="loading-spinner"></div>
          </div>
        </div>
      </div>
    </section>
  <!-- æˆ‘è¦æŠ•ç¨¿ -->
<section id="submitFormSection" class="hidden">
  <div class="card">
    <button class="btn btn-outline back-btn" onclick="showNewsList()">
      <i class="fas fa-arrow-left"></i> è¿”å›æ–°é—»åˆ—è¡¨
    </button>

    <h2 class="editor-title" style="margin-bottom: 1rem;"><i class="fas fa-pen-nib"></i> æˆ‘è¦æŠ•ç¨¿</h2>
    
    <input type="text" id="submitName" placeholder="æŠ•ç¨¿è€…å§“åï¼ˆå¿…å¡«ï¼‰" class="full-width">
    <input type="text" id="submitTitle" placeholder="æ–°é—»æ ‡é¢˜ï¼ˆå¿…å¡«ï¼‰" class="full-width">

    <div class="category-selector">
      <select id="submitCategory" class="full-width">
        <option value="ç§‘æŠ€æ–°é—»">ç§‘æŠ€æ–°é—»</option>
        <option value="æ´»åŠ¨é¢„å‘Š">æ´»åŠ¨é¢„å‘Š</option>
        <option value="å­¦æœ¯åŠ¨æ€">å­¦æœ¯åŠ¨æ€</option>
        <option value="ä½“è‚²èµ›äº‹">ä½“è‚²èµ›äº‹</option>
        <option value="ç¤¾å›¢æ´»åŠ¨">ç¤¾å›¢æ´»åŠ¨</option>
      </select>
    </div>

    <textarea id="submitContent" rows="6" placeholder="è¯·è¾“å…¥å†…å®¹..." class="full-width"></textarea>
    
    <div class="image-upload-section" style="margin-top: 1.5rem;">
  <label class="upload-label">
    <i class="fas fa-camera"></i> ä¸Šä¼ å›¾ç‰‡ï¼ˆæœ€å¤š3å¼ ï¼‰
  </label>
  <div class="upload-hint" style="font-size: 0.85rem; color: var(--color-meta); margin-bottom: 0.5rem;">
    <i class="fas fa-info-circle"></i> æ”¯æŒJPG/PNGæ ¼å¼ï¼Œæ¯å¼ ä¸è¶…è¿‡5MB
  </div>
  
  <div class="upload-area" style="
    border: 2px dashed var(--color-border);
    border-radius: 8px;
    padding: 1.5rem;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s;
    margin-bottom: 1rem;
  ">
    <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; color: var(--color-primary); margin-bottom: 0.5rem;"></i>
    <div style="font-weight: 500;">ç‚¹å‡»æˆ–æ‹–æ”¾å›¾ç‰‡åˆ°æ­¤å¤„</div>
    <div style="font-size: 0.9rem; color: var(--color-meta);">æ”¯æŒå¤šé€‰</div>
    <input type="file" id="submitImages" accept="image/*" multiple style="display: none;">
  </div>
  
  <div id="imagePreview" style="
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    gap: 0.8rem;
    margin-top: 1rem;
  "></div>
</div>

    <div class="action-buttons" style="margin-top: 1.5rem;">
      <button class="btn btn-primary" onclick="submitNews()">
        <i class="fas fa-paper-plane"></i> æäº¤æŠ•ç¨¿
      </button>
    </div>
  </div>
</section>


    <!-- æ–°é—»è¯¦æƒ… -->
    <section id="newsDetail" class="hidden">
      <div class="card">
        <button class="btn btn-outline back-btn" id="backToListBtn">
          <i class="fas fa-arrow-left"></i>
          è¿”å›åˆ—è¡¨
        </button>
        <div id="detailContent" style="margin-top: 1.5rem;"></div>
        <div class="divider"></div>
        <div class="comment-section">
  <h3><i class="fas fa-comments"></i> è¯„è®ºåŒº</h3>
  
  <!-- è¯„è®ºè¡¨å• -->
  <div class="comment-form card">
    <div class="form-header">
      <h4>å‘è¡¨è¯„è®º</h4>
      <div class="privacy-toggle">
        <label class="switch">
          <input type="checkbox" id="commentAnonymous">
          <span class="slider round"></span>
        </label>
        <span>åŒ¿åå‘è¡¨</span>
      </div>
    </div>
    
    <textarea id="commentContent" placeholder="å†™ä¸‹æ‚¨çš„æƒ³æ³•..." rows="3"></textarea>
    
    <div class="comment-meta">
      <input type="text" id="commentName" placeholder="æ˜µç§°ï¼ˆå¯é€‰ï¼‰" class="name-input">
      <button class="btn btn-primary" id="submitComment">
        <i class="fas fa-paper-plane"></i> å‘å¸ƒè¯„è®º
      </button>
    </div>
  </div>
  
  <!-- è¯„è®ºåˆ—è¡¨ -->
  <div class="comment-list" id="commentList">
    <!-- è¯„è®ºå°†åœ¨è¿™é‡ŒåŠ¨æ€åŠ è½½ -->
  </div>
        </div>
      </div>
    </section>
  </div>

  <!-- ç®¡ç†å‘˜ç™»å½•æ¨¡æ€æ¡† -->
  <div id="adminModal" class="modal">
    <div class="modal-content">
      <h3 class="modal-title"><i class="fas fa-user-shield"></i> ç®¡ç†å‘˜éªŒè¯</h3>
      <input type="password" id="adminPassword" placeholder="è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç " class="full-width" />
      <div class="action-buttons" style="margin-top: 1.5rem;">
        <button class="btn btn-primary" id="confirmLoginBtn">
          <i class="fas fa-sign-in-alt"></i>
          ç¡®è®¤ç™»å½•
        </button>
        <button class="btn btn-danger" id="cancelLoginBtn">
          <i class="fas fa-times"></i>
          å–æ¶ˆ
        </button>
      </div>
    </div>
  </div>

  <footer>
  <p>Â© 2025 æ–°å±±å®½æŸ”ä¸­å­¦å¿«è®¯ç»„ | è®¾è®¡: <a href="tanjunyuanfoonyew@gmail.com">é™ˆä¿Šæº</a></p>
  </footer>

  <script>
    // JavaScript ä»£ç éƒ¨åˆ†

    const firebaseConfig = {
      apiKey: "AIzaSyBRnuwJhNE8zgWSZ2USJT5pCh138ik4G54",
      authDomain: "fymcsnewsjb.firebaseapp.com",
      projectId: "fymcsnewsjb",
      storageBucket: "fymcsnewsjb.appspot.com",
      messagingSenderId: "843017779813",
      appId: "1:843017779813:web:180674b052abbf9b36248c",
      measurementId: "G-M9L0H4E2FR"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
let editingId = null;
let role = "";

    // é¡µé¢å…ƒç´ å¼•ç”¨
    const editor = document.getElementById("editor");
    const titleInput = document.getElementById("titleInput");
    const categorySelect = document.getElementById("categorySelect");
    const logoutBtn = document.getElementById("logoutBtn");
    const adminLoginBtn = document.getElementById("adminLoginBtn");
    const guestLoginBtn = document.getElementById("guestLoginBtn");
    const draftBtn = document.getElementById("draftBtn");
    const publishBtn = document.getElementById("publishBtn");
    const newsFilter = document.getElementById("newsFilter");
    const categoryFilter = document.getElementById("categoryFilter");
    const backToListBtn = document.getElementById("backToListBtn");
    const confirmLoginBtn = document.getElementById("confirmLoginBtn");
    const cancelLoginBtn = document.getElementById("cancelLoginBtn");
    const adminModal = document.getElementById("adminModal");
    const adminPassword = document.getElementById("adminPassword");
    const themeToggle = document.querySelector(".theme-toggle");
    // æ‹–æ‹½ä¸Šä¼ åŠŸèƒ½
const dropZone = document.getElementById('dropZone');
const fileInput = document.getElementById('carouselImageUpload');

// æ‹–æ‹½æ•ˆæœ
dropZone.addEventListener('dragover', (e) => {
  e.preventDefault();
  dropZone.classList.add('drag-over');
});

dropZone.addEventListener('dragleave', () => {
  dropZone.classList.remove('drag-over');
});

dropZone.addEventListener('drop', (e) => {
  e.preventDefault();
  dropZone.classList.remove('drag-over');
  if (e.dataTransfer.files.length) {
    fileInput.files = e.dataTransfer.files;
    updatePreview();
  }
});

// æ–‡ä»¶é€‰æ‹©å¤„ç†
fileInput.addEventListener('change', updatePreview);

function updatePreview() {
  const file = fileInput.files[0];
  const uploadBtn = document.getElementById('uploadCarouselImage');
  
  if (file) {
    // æ˜¾ç¤ºæ–‡ä»¶å
    dropZone.innerHTML = `
      <i class="fas fa-file-image"></i>
      <h3>${file.name}</h3>
      <p>${(file.size / 1024).toFixed(1)} KB</p>
    `;
    uploadBtn.disabled = false;
    
    // å›¾ç‰‡é¢„è§ˆ
    const reader = new FileReader();
    reader.onload = (e) => {
      dropZone.style.backgroundImage = `url(${e.target.result})`;
      dropZone.style.backgroundSize = 'cover';
    };
    reader.readAsDataURL(file);
  }
}

    // åˆå§‹åŒ–æ•°æ®åº“
    async function togglePinNews(id, isPinned) {
      try {
        await db.collection("news").doc(id).update({ pinned: isPinned });
        return true;
      } catch (error) {
        console.error("ç½®é¡¶æ“ä½œå¤±è´¥:", error);
        return false;
      }
    }
    
    // è·å–æ‰€æœ‰æ–°é—»ï¼ˆæŒ‰æ—¶é—´å€’åºæ’åˆ—ï¼‰
    async function getAllNews() {
      try {
        const snapshot = await db.collection("news")
          .where("status", "==", "published") // âœ… åªå–å·²å‘å¸ƒæ–°é—»
          .orderBy("status") // âœ… Firestore ç´¢å¼•éœ€è¦è¿™ä¸ªé¡ºåº
          .orderBy("pinned", "desc")
          .orderBy("time", "desc")
          .get();
        
        return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
      } catch (error) {
        console.error("è·å–æ–°é—»å¤±è´¥:", error);
        return [];
      }
    }
    
    // æ·»åŠ æ–°æ–°é—»
    async function addNews(newsItem) {
      await db.collection("news").add(newsItem);
    }
    
    // æ›´æ–°æ–°é—»
    async function updateNews(newsItem) {
      await db.collection("news").doc(newsItem.id).update(newsItem);
    }
    
    // åˆ é™¤æ–°é—»
    async function deleteNewsById(id) {
      await db.collection("news").doc(id).delete();
    }
    
    // è·å–å•æ¡æ–°é—»
    async function getNewsById(id) {
      const doc = await db.collection("news").doc(id).get();
      return doc.exists ? { id: doc.id, ...doc.data() } : null;
    }
    
    // æŒ‰ç±»åˆ«è·å–æ–°é—»
    async function getNewsByCategory(category) {
      try {
        let query = db.collection("news").orderBy("time", "desc");
        if (category !== "all") {
          query = query.where("category", "==", category);
        }
        const snapshot = await query.get();
        return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
      } catch (error) {
        console.error("æŒ‰ç±»åˆ«è·å–æ–°é—»å¤±è´¥:", error);
        throw error; // æŠ›å‡ºé”™è¯¯ä»¥ä¾¿ä¸Šå±‚å¤„ç†
      }
    }
    
    // æŒ‰çŠ¶æ€è·å–æ–°é—»ï¼ˆå‘å¸ƒ/è‰ç¨¿ï¼‰
    async function getNewsByStatus(status) {
      let query = db.collection("news").orderBy("time", "desc");
      if (status !== "all") {
        query = query.where("status", "==", status);
      }
      const snapshot = await query.get();
      return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
    }

    // ä¸»é¢˜åˆ‡æ¢
    function toggleTheme() {
      const currentTheme = document.documentElement.getAttribute('data-theme');
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      document.documentElement.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
      
      // æ›´æ–°å›¾æ ‡
      const themeIcon = document.querySelector('.theme-toggle i');
      themeIcon.className = newTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
    }

    // æ˜¾ç¤ºç®¡ç†å‘˜ç™»å½•æ¨¡æ€æ¡†
    function showAdminLogin() {
      adminModal.style.display = "flex";
      adminPassword.focus();
    }

    function generateNewsCard(n, isAdmin = false) {
  const publicUrl = `${window.location.origin}${window.location.pathname}?id=${n.id}`;
  
  return `
  <div class="card news-card ${n.pinned ? 'pinned-news' : ''}" data-id="${n.id}">
    <div class="news-meta">
      <span><i class="fas fa-calendar-alt"></i> ${formatDate(n.time)}</span>
      <span class="category-tag">${n.category}</span>
      ${n.pinned ? '<span class="badge pinned"><i class="fas fa-thumbtack"></i> ç½®é¡¶</span>' : ''}
    </div>
    <h3>${n.title}</h3>
    <div class="news-excerpt">
      ${stripHtml(n.content).substring(0, 100)}...
    </div>
    <div class="news-footer" style="display: flex; justify-content: space-between; align-items: center; margin-top: 1rem;">
      <button class="btn btn-outline read-more" data-id="${n.id}">
        <i class="fas fa-book-open"></i> é˜…è¯»æ›´å¤š
      </button>
      <div class="share-icons" style="display: flex; gap: 0.5rem;">
        <a href="https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(publicUrl)}" 
           target="_blank" title="åˆ†äº«åˆ°Facebook" style="color: #3b5998;">
          <i class="fab fa-facebook-f"></i>
        </a>
        <a href="https://twitter.com/intent/tweet?url=${encodeURIComponent(publicUrl)}&text=${encodeURIComponent(n.title)}" 
           target="_blank" title="åˆ†äº«åˆ°Twitter" style="color: #1da1f2;">
          <i class="fab fa-twitter"></i>
        </a>
        <a href="https://www.threads.net/intent/post?text=${encodeURIComponent(n.title + '\n\n' + publicUrl)}" 
           target="_blank" title="åˆ†äº«åˆ°Threads" style="color: #000;">
          <i class="fab fa-instagram"></i>
        </a>
        <a href="https://api.whatsapp.com/send?text=${encodeURIComponent(n.title + ' - ' + publicUrl)}" 
           target="_blank" title="åˆ†äº«åˆ°WhatsApp" style="color: #25d366;">
          <i class="fab fa-whatsapp"></i>
        </a>
      </div>
    </div>
    ${isAdmin ? `
    <div class="action-buttons">
      <button class="btn btn-primary edit-news" data-id="${n.id}">
        <i class="fas fa-edit"></i> ç¼–è¾‘
      </button>
      <button class="btn btn-danger delete-news" data-id="${n.id}">
        <i class="fas fa-trash"></i> åˆ é™¤
      </button>
      <button class="btn ${n.pinned ? 'btn-warning' : 'btn-secondary'} pin-news" data-id="${n.id}">
        <i class="fas fa-thumbtack"></i> ${n.pinned ? 'å–æ¶ˆç½®é¡¶' : 'ç½®é¡¶'}
      </button>
    </div>
    ` : ''}
  </div>
  `;
}

    // éšè—ç®¡ç†å‘˜ç™»å½•æ¨¡æ€æ¡†
    function hideAdminModal() {
      adminModal.style.display = "none";
      adminPassword.value = "";
    }

    // ç®¡ç†å‘˜ç™»å½•éªŒè¯
    function verifyAdmin() {
      const password = adminPassword.value;
      if (password === "Microcomputersociety") {
        loginAs("admin");
        hideAdminModal();
        document.getElementById('submissionReview').classList.remove('hidden');
        loadSubmissions();
      } else {
        alert("âš ï¸ å¯†ç é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥ï¼");
        adminPassword.value = "";
      }
    }

    // ç”¨æˆ·ç™»å½•ç³»ç»Ÿ
async function loginAs(selectedRole) {
  console.log("Logging in as:", selectedRole);
  role = selectedRole;
  document.querySelectorAll('section').forEach(el => el.classList.add('hidden'));
  logoutBtn.classList.remove('hidden');
  
  if (role === 'admin') {
    document.getElementById('dashboard').classList.remove('hidden');
    console.log("Loading admin news...");
    await loadNewsForAdmin();
    await loadCarouselImages(); // ç¡®ä¿åŠ è½½å°é¢å›¾ç‰‡
    
    // åªåœ¨ç®¡ç†å‘˜ç™»å½•æ—¶åŠ è½½å°é¢å›¾ç‰‡ç®¡ç†
    loadCarouselImages();
    document.getElementById('uploadCarouselImage').addEventListener('click', uploadCarouselImage);
  } else {
    document.getElementById('newsList').classList.remove('hidden');
    await loadNewsList();
  }
}

    // ç™»å‡ºåŠŸèƒ½
    function logout() {
      role = "";
      document.querySelectorAll('section').forEach(el => el.classList.add('hidden'));
      document.getElementById('login').classList.remove('hidden');
      logoutBtn.classList.add('hidden');
      titleInput.value = "";
      editor.innerHTML = "";
      editingId = null;
    }

    // å¯Œæ–‡æœ¬ç¼–è¾‘å™¨åŠŸèƒ½
    function execCmd(cmd, value = null) {
      document.execCommand(cmd, false, value);
      editor.focus();
    }

    function formatDate(isoString) {
      const date = new Date(isoString);
      return date.toLocaleString('zh-CN', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit'
      });
    }

    function stripHtml(html) {
      const tmp = document.createElement("div");
      tmp.innerHTML = html;
      return tmp.textContent || tmp.innerText || "";
    }

    // æ–°é—»å‘å¸ƒ/æ›´æ–°åŠŸèƒ½
    async function publishNews() {
      const title = titleInput.value.trim();
      const content = editor.innerHTML.trim();
      const category = categorySelect.value;
      
      if (!title) return alert("âš ï¸ è¯·è¾“å…¥æ–°é—»æ ‡é¢˜ï¼");
      if (!content || content === "<p><br></p>") return alert("âš ï¸ æ–°é—»å†…å®¹ä¸èƒ½ä¸ºç©ºï¼");
      
      try {
        const newsItem = {
          title,
          content,
          category,
          editor: "ç®¡ç†å‘˜",
          time: new Date().toISOString(),  // æ”¹ä¸ºISOæ ¼å¼æ—¶é—´
          status: 'published'
        };
        
        if (editingId) {
          // æ›´æ–°ç°æœ‰æ–°é—»
          await db.collection("news").doc(editingId).update(newsItem);
          editingId = null;
          publishBtn.innerHTML = '<i class="fas fa-paper-plane"></i> å‘å¸ƒæ–°é—»';
        } else {
          // æ–°å¢æ–°é—»
          await db.collection("news").add(newsItem);
        }
        
        // é‡ç½®è¡¨å•
        titleInput.value = "";
        editor.innerHTML = "";
        categorySelect.value = "ç§‘æŠ€æ–°é—»";
        
        // é‡æ–°åŠ è½½æ–°é—»åˆ—è¡¨
        await loadNewsForAdmin();
        alert(editingId ? "âœ… æ–°é—»æ›´æ–°æˆåŠŸï¼" : "âœ… æ–°é—»å‘å¸ƒæˆåŠŸï¼");
      } catch (error) {
        console.error("å‘å¸ƒæ–°é—»å¤±è´¥:", error);
        alert("âŒ å‘å¸ƒæ–°é—»å¤±è´¥ï¼Œè¯·é‡è¯•ï¼é”™è¯¯ä¿¡æ¯: " + error.message);
      }
    }

    async function saveAsDraft() {
  const title = titleInput.value.trim();
  const content = editor.innerHTML.trim();
  const category = categorySelect.value;
  
  if (!title && !content) return alert("âš ï¸ è¯·è¾“å…¥æ ‡é¢˜æˆ–å†…å®¹ï¼");

  try {
    const newsItem = {
      title: title || "æ— æ ‡é¢˜",
      content: content || "<p>æ— å†…å®¹</p>",
      category,
      editor: "ç®¡ç†å‘˜",
      time: new Date().toISOString(),
      status: 'draft'
    };
    
    if (editingId) {
      // æ›´æ–°ç°æœ‰è‰ç¨¿
      await db.collection("news").doc(editingId).update(newsItem);
      alert("ğŸ“ è‰ç¨¿æ›´æ–°æˆåŠŸï¼");
    } else {
      // æ–°å¢è‰ç¨¿
      await db.collection("news").add(newsItem);
      alert("ğŸ“ è‰ç¨¿ä¿å­˜æˆåŠŸï¼");
    }
    
    // é‡æ–°åŠ è½½æ–°é—»åˆ—è¡¨
    await loadNewsForAdmin(); // è¿™é‡Œä¿®æ­£äº†å‡½æ•°å
    
  } catch (error) {
    console.error("ä¿å­˜è‰ç¨¿å¤±è´¥:", error);
    alert("âŒ ä¿å­˜è‰ç¨¿å¤±è´¥ï¼Œè¯·é‡è¯•ï¼é”™è¯¯ä¿¡æ¯: " + error.message);
  }
}

    // æ–°é—»åˆ é™¤åŠŸèƒ½
    async function deleteNews(id) {
      if (!confirm("âš ï¸ ç¡®å®šè¦æ°¸ä¹…åˆ é™¤è¿™æ¡æ–°é—»å—ï¼Ÿ")) return;
      
      try {
        await deleteNewsById(id);
        await loadNewsForAdmin();
        alert("ğŸ—‘ï¸ æ–°é—»å·²åˆ é™¤ï¼");
      } catch (error) {
        console.error("åˆ é™¤æ–°é—»å¤±è´¥:", error);
        alert("âŒ åˆ é™¤æ–°é—»å¤±è´¥ï¼Œè¯·é‡è¯•ï¼");
      }
    }

    // æ–°é—»ç¼–è¾‘åŠŸèƒ½
    async function editNews(id) {
      try {
        const newsItem = await getNewsById(id);
        titleInput.value = newsItem.title;
        editor.innerHTML = newsItem.content;
        categorySelect.value = newsItem.category || "ç§‘æŠ€æ–°é—»";
        editingId = id;
        
        // æ›´æ–°æŒ‰é’®æ–‡æœ¬
        publishBtn.innerHTML = 
          newsItem.status === 'draft' ? 
          '<i class="fas fa-paper-plane"></i> å‘å¸ƒæ–°é—»' : 
          '<i class="fas fa-sync-alt"></i> æ›´æ–°æ–°é—»';
        
        window.scrollTo({ top: 0, behavior: "smooth" });
      } catch (error) {
        console.error("åŠ è½½æ–°é—»å¤±è´¥:", error);
        alert("âŒ åŠ è½½æ–°é—»å¤±è´¥ï¼Œè¯·é‡è¯•ï¼");
      }
    }

    async function loadSubmissions() {
      const container = document.getElementById("submissionContainer");
      try {
        const snapshot = await db.collection("submissions").orderBy("time", "desc").get();
        if (snapshot.empty) {
          container.innerHTML = `<p style="text-align: center; color: var(--color-meta);">æš‚æ— æŠ•ç¨¿</p>`;
          return;
        }
        
        container.innerHTML = snapshot.docs.map(doc => {
          const s = doc.data();
          const images = (s.images || []).map(url => `<img src="${url}" style="width: 100px; border-radius: 6px; box-shadow: 0 2px 6px rgba(0,0,0,0.15); margin-right: 0.5rem;">`).join("");
          return `
          <div class="card" data-id="${doc.id}">
          <div class="news-meta">
            <span><i class="fas fa-user"></i> ${s.name}</span>
            <span><i class="fas fa-calendar-alt"></i> ${formatDate(s.time)}</span>
            <span class="category-tag">${s.category}</span>
          </div>
          <h3>${s.title}</h3>
          <p style="margin: 1rem 0; color: var(--color-text);">${s.content}</p>
          <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">${images}</div>
          <div class="action-buttons" style="margin-top: 1rem;">
            <button class="btn btn-primary" onclick="approveSubmission('${doc.id}')">
              <i class="fas fa-check"></i> å®¡æ ¸å¹¶å‘å¸ƒ
            </button>
            <button class="btn btn-danger" onclick="deleteSubmission('${doc.id}')">
              <i class="fas fa-trash"></i> åˆ é™¤æŠ•ç¨¿
            </button>
          </div>
          </div>
          `;
        }).join("");
      
      } catch (error) {
        console.error("åŠ è½½æŠ•ç¨¿å¤±è´¥ï¼š", error);
        container.innerHTML = `<p style="text-align: center; color: var(--color-accent);">åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°</p>`;
      }
    }

    async function approveSubmission(id) {
      try {
        const doc = await db.collection("submissions").doc(id).get();
        if (!doc.exists) return;
        
        const data = doc.data();
        await db.collection("news").add({
          title: data.title,
          content: data.content,
          category: data.category,
          editor: data.name || "æŠ•ç¨¿è€…",
          time: new Date().toISOString(),
          status: "published",
          pinned: false,
          images: data.images || []
        });
        
        await db.collection("submissions").doc(id).delete();
        alert("âœ… æŠ•ç¨¿å·²å‘å¸ƒä¸ºæ–°é—»ï¼");
        await loadSubmissions();
        await loadNewsForAdmin();
      } catch (error) {
        console.error("å‘å¸ƒå¤±è´¥ï¼š", error);
        alert("âŒ å‘å¸ƒå¤±è´¥ï¼");
      }
    }

async function deleteSubmission(id) {
  if (!confirm("âš ï¸ ç¡®å®šåˆ é™¤è¿™æ¡æŠ•ç¨¿ï¼Ÿ")) return;
  try {
    await db.collection("submissions").doc(id).delete();
    alert("ğŸ—‘ï¸ æŠ•ç¨¿å·²åˆ é™¤");
    await loadSubmissions();
  } catch (error) {
    console.error("åˆ é™¤å¤±è´¥ï¼š", error);
    alert("âŒ åˆ é™¤å¤±è´¥ï¼");
  }
}

    // åŠ è½½ç®¡ç†å‘˜ç•Œé¢
    // ç®¡ç†å‘˜ç•Œé¢åŠ è½½æ–°é—»
async function loadNewsForAdmin() {
  const container = document.getElementById("newsListAdmin");
  const filter = newsFilter.value;
  
  try {
    // Show loading state
    container.innerHTML = `
      <div class="card">
        <div class="loading">
          <div class="loading-spinner"></div>
          <p>æ­£åœ¨åŠ è½½æ–°é—»æ•°æ®...</p>
        </div>
      </div>`;
    
    let news = [];
    let query = db.collection("news");
    
    // Apply filters based on selection
    switch(filter) {
      case 'drafts':
        query = query.where("status", "==", "draft");
        break;
      case 'published':
        query = query.where("status", "==", "published");
        break;
      // 'all' case falls through to default
    }
    
    // Always order by time descending
    const snapshot = await query.orderBy("time", "desc").get();
    news = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
    
    // Handle empty results
    if (news.length === 0) {
      container.innerHTML = `
        <div class="card">
          <p style="text-align: center; color: var(--color-meta);">
            <i class="fas fa-info-circle"></i> 
            ${filter === 'drafts' ? 'æ²¡æœ‰æ‰¾åˆ°è‰ç¨¿' : 
              filter === 'published' ? 'æ²¡æœ‰å·²å‘å¸ƒçš„æ–°é—»' : 'æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æ–°é—»'}
          </p>
          <div style="text-align: center; margin-top: 1rem;">
            <button class="btn btn-primary" onclick="loadNewsForAdmin()">
              <i class="fas fa-sync-alt"></i> åˆ·æ–°
            </button>
          </div>
        </div>`;
      return;
    }
    
    // Render news cards
    container.innerHTML = news.map(n => generateNewsCard(n, true)).join("");
    
    // Add event listeners
    setupNewsCardEventListeners();
    
    // Show success message (optional)
    showToast(`æˆåŠŸåŠ è½½ ${news.length} æ¡æ–°é—»`, 'success');
    
  } catch (error) {
    console.error("åŠ è½½æ–°é—»åˆ—è¡¨å¤±è´¥:", error);
    
    let errorMessage = "åŠ è½½æ–°é—»å¤±è´¥";
    if (error.code === 'permission-denied') {
      errorMessage = "æƒé™ä¸è¶³ï¼Œæ— æ³•åŠ è½½æ–°é—»";
    } else if (error.code === 'unavailable') {
      errorMessage = "ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ";
    }
    
    container.innerHTML = `
      <div class="card">
        <p style="text-align: center; color: var(--color-accent);">
          <i class="fas fa-exclamation-triangle"></i> ${errorMessage}
        </p>
        <div style="text-align: center; margin-top: 1rem;">
          <button class="btn btn-primary" onclick="loadNewsForAdmin()">
            <i class="fas fa-sync-alt"></i> é‡è¯•
          </button>
        </div>
        ${role === 'admin' ? `
        <div style="text-align: center; margin-top: 0.5rem;">
          <button class="btn btn-outline" onclick="location.reload()">
            <i class="fas fa-redo"></i> åˆ·æ–°é¡µé¢
          </button>
        </div>
        ` : ''}
      </div>`;
  }
}

// Helper function to setup event listeners
function setupNewsCardEventListeners() {
  // Edit buttons
  document.querySelectorAll('.edit-news').forEach(btn => {
    btn.addEventListener('click', () => editNews(btn.dataset.id));
  });
  
  // Delete buttons
  document.querySelectorAll('.delete-news').forEach(btn => {
    btn.addEventListener('click', async () => {
      const id = btn.dataset.id;
      if (confirm("âš ï¸ ç¡®å®šè¦æ°¸ä¹…åˆ é™¤è¿™æ¡æ–°é—»å—ï¼Ÿæ­¤æ“ä½œæ— æ³•æ’¤é”€ï¼")) {
        try {
          await deleteNewsById(id);
          showToast("æ–°é—»å·²åˆ é™¤", 'success');
          await loadNewsForAdmin();
        } catch (error) {
          showToast("åˆ é™¤å¤±è´¥: " + error.message, 'error');
        }
      }
    });
  });
  
  // Pin buttons
  document.querySelectorAll('.pin-news').forEach(btn => {
    btn.addEventListener('click', async () => {
      const id = btn.dataset.id;
      const isPinned = btn.textContent.includes("å–æ¶ˆ");
      
      try {
        const success = await togglePinNews(id, !isPinned);
        if (success) {
          showToast(isPinned ? "å·²å–æ¶ˆç½®é¡¶" : "æ–°é—»å·²ç½®é¡¶", 'success');
          await loadNewsForAdmin();
        }
      } catch (error) {
        showToast("æ“ä½œå¤±è´¥: " + error.message, 'error');
      }
    });
  });
}

// Simple toast notification function
function showToast(message, type = 'info') {
  const toast = document.createElement('div');
  toast.className = `toast toast-${type}`;
  toast.innerHTML = `
    <i class="fas fa-${type === 'success' ? 'check-circle' : 
                     type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
    ${message}
  `;
  document.body.appendChild(toast);
  
  setTimeout(() => {
    toast.classList.add('fade-out');
    setTimeout(() => toast.remove(), 500);
  }, 3000);
}

    async function loadCarouselImages() {
  try {
    const container = document.getElementById('carouselImagesContainer');
    container.innerHTML = '<div class="loading"><div class="loading-spinner"></div></div>';
    
    const snapshot = await db.collection('carouselImages')
      .orderBy('uploadedAt', 'desc')
      .get();
    
    if (snapshot.empty) {
      container.innerHTML = '<p style="text-align: center; color: var(--color-meta);">æš‚æ— å°é¢å›¾ç‰‡</p>';
      return;
    }
    
    let html = '';
    snapshot.forEach(doc => {
      const image = doc.data();
      html += `
        <div class="carousel-image-item" data-id="${doc.id}">
          <img src="${image.url}" class="carousel-image-preview">
          <div class="carousel-image-url">${image.url}</div>
          <div class="carousel-image-actions">
            <button class="btn btn-danger delete-carousel-image" data-id="${doc.id}">
              <i class="fas fa-trash"></i> åˆ é™¤
            </button>
          </div>
        </div>
      `;
    });
    
    container.innerHTML = html;

    // ç»‘å®šåˆ é™¤äº‹ä»¶
    document.querySelectorAll('.delete-carousel-image').forEach(btn => {
      btn.addEventListener('click', async () => {
        if(confirm('ç¡®å®šåˆ é™¤è¿™å¼ å°é¢å›¾ç‰‡å—ï¼Ÿ')) {
          try {
            await db.collection('carouselImages').doc(btn.dataset.id).delete();
            loadCarouselImages(); // é‡æ–°åŠ è½½
            showToast('å›¾ç‰‡åˆ é™¤æˆåŠŸ', 'success');
          } catch (error) {
            showToast('åˆ é™¤å¤±è´¥: ' + error.message, 'error');
          }
        }
      });
    });
    
  } catch (error) {
    console.error('åŠ è½½å°é¢å›¾ç‰‡å¤±è´¥:', error);
    document.getElementById('carouselImagesContainer').innerHTML = `
      <div class="card">
        <p style="text-align: center; color: var(--color-accent);">
          <i class="fas fa-exclamation-triangle"></i> åŠ è½½å¤±è´¥: ${error.message}
        </p>
        <div style="text-align: center; margin-top: 1rem;">
          <button class="btn btn-primary" onclick="loadCarouselImages()">
            <i class="fas fa-sync-alt"></i> é‡æ–°åŠ è½½
          </button>
        </div>
      </div>
    `;
  }
}

    async function uploadCarouselImage() {
      document.getElementById('uploadCarouselImage').addEventListener('click', uploadCarouselImage);

  const fileInput = document.getElementById('carouselImageUpload');
  const file = fileInput.files[0];
  const uploadBtn = document.getElementById('uploadCarouselImage');

  if (!file) {
    alert("è¯·å…ˆé€‰æ‹©å›¾ç‰‡");
    return;
  }

  try {
    // ç¦ç”¨æŒ‰é’®é˜²æ­¢é‡å¤ç‚¹å‡»
    uploadBtn.disabled = true;
    uploadBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ä¸Šä¼ ä¸­...';

    // åˆ›å»ºå­˜å‚¨å¼•ç”¨
    const storageRef = storage.ref();
    const fileRef = storageRef.child(`carousel/${Date.now()}_${file.name}`);

    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
    const dropZone = document.getElementById('dropZone');
    dropZone.classList.add('uploading');

    // æ‰§è¡Œä¸Šä¼ 
    const snapshot = await fileRef.put(file);
    const downloadURL = await snapshot.ref.getDownloadURL();

    // ä¿å­˜åˆ°Firestore
    await db.collection("carouselImages").add({
      url: downloadURL,
      uploadedAt: new Date().toISOString(),
      fileName: file.name
    });

    // é‡ç½®çŠ¶æ€
    showToast('å›¾ç‰‡ä¸Šä¼ æˆåŠŸ', 'success');
    loadCarouselImages(); // åˆ·æ–°åˆ—è¡¨
    resetUploadUI();
    
  } catch (error) {
    console.error("ä¸Šä¼ å¤±è´¥:", error);
    showToast(`ä¸Šä¼ å¤±è´¥: ${error.message}`, 'error');
    uploadBtn.disabled = false;
    uploadBtn.innerHTML = '<i class="fas fa-upload"></i> é‡æ–°ä¸Šä¼ ';
  }
}

function resetUploadUI() {
  const dropZone = document.getElementById('dropZone');
  const uploadBtn = document.getElementById('uploadCarouselImage');
  
  dropZone.classList.remove('uploading');
  dropZone.innerHTML = `
    <i class="fas fa-cloud-upload-alt upload-icon"></i>
    <h3>æ‹–æ”¾å›¾ç‰‡åˆ°æ­¤å¤„</h3>
    <p>æˆ–</p>
    <label for="carouselImageUpload" class="btn btn-outline">
      <i class="fas fa-folder-open"></i> é€‰æ‹©æ–‡ä»¶
    </label>
  `;
  uploadBtn.disabled = true;
  document.getElementById('carouselImageUpload').value = '';
}

    async function deleteCarouselImage(id) {
  if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™å¼ å°é¢å›¾ç‰‡å—ï¼Ÿ')) return;
  
  try {
    // ä»Firestoreåˆ é™¤è®°å½•
    await db.collection('carouselImages').doc(id).delete();
    
    // é‡æ–°åŠ è½½å›¾ç‰‡åˆ—è¡¨
    await loadCarouselImages();
    alert('å›¾ç‰‡åˆ é™¤æˆåŠŸï¼');
  } catch (error) {
    console.error('åˆ é™¤å¤±è´¥:', error);
    alert('åˆ é™¤å¤±è´¥: ' + error.message);
  }
}

    async function initCarousel() {
  const carousel = document.getElementById('newsCarousel');
  
  try {
    // è·å–æ‰€æœ‰å°é¢å›¾ç‰‡
    const snapshot = await db.collection('carouselImages').orderBy('uploadedAt', 'desc').get();
    const carouselImages = snapshot.docs.map(doc => doc.data().url);
    
    // å¦‚æœæœ‰å°é¢å›¾ç‰‡ï¼Œæ˜¾ç¤ºå®ƒä»¬
    if (carouselImages.length > 0) {
      // æ¸…ç©ºç°æœ‰å†…å®¹
      carousel.innerHTML = `
        <div class="carousel-nav"></div>
        <button class="carousel-control carousel-prev">
          <i class="fas fa-chevron-left"></i>
        </button>
        <button class="carousel-control carousel-next">
          <i class="fas fa-chevron-right"></i>
        </button>
      `;
      
      const navContainer = carousel.querySelector('.carousel-nav');
      
      // æ·»åŠ æ¯å¼ å›¾ç‰‡åˆ°è½®æ’­
      carouselImages.forEach((url, index) => {
        const slide = document.createElement('div');
        slide.className = 'carousel-slide';
        slide.style.backgroundImage = `linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('${url}')`;
        carousel.insertBefore(slide, navContainer);
        
        // æ·»åŠ å¯¼èˆªç‚¹
        const dot = document.createElement('div');
        dot.className = 'carousel-dot';
        dot.dataset.index = index;
        navContainer.appendChild(dot);
      });
      
      // åˆå§‹åŒ–è½®æ’­é€»è¾‘
      initCarouselLogic();
    } else {
      // å¦‚æœæ²¡æœ‰å°é¢å›¾ç‰‡ï¼Œä¿æŒåŸæ¥çš„ç½®é¡¶æ–°é—»é€»è¾‘
      const newsItems = await getPinnedNews();
      initCarouselWithNews(newsItems);
    }
  } catch (error) {
    console.error('åˆå§‹åŒ–è½®æ’­å¤±è´¥:', error);
    // å‡ºé”™æ—¶ä¹Ÿå°è¯•æ˜¾ç¤ºç½®é¡¶æ–°é—»
    const newsItems = await getPinnedNews();
    initCarouselWithNews(newsItems);
  }
}
    // åŠ è½½æ–°é—»åˆ—è¡¨
    async function loadNewsList() {
  try {
    const category = categoryFilter.value;
    const news = await getNewsByCategory(category);
    
    // æŒ‰æ—¶é—´é™åºæ’åº
    news.sort((a, b) => new Date(b.time) - new Date(a.time));
    const container = document.getElementById("newsItems");
    
    // åˆå§‹åŒ–å°é¢æ»šåŠ¨
    initCarousel(news.filter(n => n.pinned).slice(0, 5)); // æœ€å¤šæ˜¾ç¤º5æ¡ç½®é¡¶æ–°é—»
    
    if (news.length === 0) {
      container.innerHTML = `
      <div class="card">
      <p style="text-align: center; color: var(--color-meta);">
        æš‚æ— æ–°é—»
        </p>
        </div>
        `;
      return;
    }
    
    container.innerHTML = news.map(n => `
    <div class="card news-card clickable" data-id="${n.id}">
    <div class="news-meta">
    <span><i class="fas fa-calendar-alt"></i> ${formatDate(n.time)}</span>
    <span class="category-tag">${n.category}</span>
    </div>
    <h3>${n.title}</h3>
    <div class="news-excerpt">
    ${stripHtml(n.content).substring(0, 100)}...
    </div>
    </div>
    `).join("");
    
    // æ·»åŠ ç‚¹å‡»äº‹ä»¶
    document.querySelectorAll('.news-card').forEach(card => {
      card.addEventListener('click', () => {
        showNewsDetail(card.dataset.id);
      });
    });
  } catch (error) {
    console.error("åŠ è½½æ–°é—»åˆ—è¡¨å¤±è´¥:", error);
    document.getElementById("newsItems").innerHTML = `
    <div class="card">
    <p style="text-align: center; color: var(--color-accent);">
    <i class="fas fa-exclamation-triangle"></i> åŠ è½½æ–°é—»åˆ—è¡¨å¤±è´¥: ${error.message}
    </p>
    </div>
    `;
  }
}

// æ–°å¢å°é¢æ»šåŠ¨åŠŸèƒ½
function initCarousel(newsItems) {
  const carousel = document.getElementById('newsCarousel');
  const navContainer = carousel.querySelector('.carousel-nav');
  const prevBtn = carousel.querySelector('.carousel-prev');
  const nextBtn = carousel.querySelector('.carousel-next');
  
  // å¦‚æœæ²¡æœ‰ç½®é¡¶æ–°é—»ï¼Œéšè—è½®æ’­
  if (!newsItems || newsItems.length === 0) {
    carousel.style.display = 'none';
    return;
  }
  
  // æ¸…ç©ºç°æœ‰å†…å®¹
  carousel.querySelectorAll('.carousel-slide').forEach(slide => slide.remove());
  navContainer.innerHTML = '';
  
  // åˆ›å»ºå¹»ç¯ç‰‡
  newsItems.forEach((item, index) => {
    const slide = document.createElement('div');
    slide.className = 'carousel-slide';
    slide.style.backgroundImage = `linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('${item.imageUrl || 'https://i.postimg.cc/j2f30H5z/2025.png'}')`;
    slide.innerHTML = `
      <div class="carousel-content">
        <h3>${item.title}</h3>
        <p>${stripHtml(item.content).substring(0, 100)}...</p>
        <button class="btn btn-outline read-more" data-id="${item.id}" style="margin-top: 1rem; color: white; border-color: white;">
          <i class="fas fa-book-open"></i> é˜…è¯»æ›´å¤š
        </button>
      </div>
    `;
    carousel.appendChild(slide);
    
    // åˆ›å»ºå¯¼èˆªç‚¹
    const dot = document.createElement('div');
    dot.className = 'carousel-dot';
    dot.dataset.index = index;
    navContainer.appendChild(dot);
  });
  
  // è®¾ç½®åˆå§‹çŠ¶æ€
  let currentIndex = 0;
  const slides = carousel.querySelectorAll('.carousel-slide');
  const dots = navContainer.querySelectorAll('.carousel-dot');
  
  function showSlide(index) {
    slides.forEach(slide => slide.classList.remove('active'));
    dots.forEach(dot => dot.classList.remove('active'));
    
    slides[index].classList.add('active');
    dots[index].classList.add('active');
    currentIndex = index;
  }
  
  // åˆå§‹æ˜¾ç¤ºç¬¬ä¸€å¼ 
  showSlide(0);
  
  // è‡ªåŠ¨è½®æ’­
  let interval = setInterval(() => {
    const nextIndex = (currentIndex + 1) % slides.length;
    showSlide(nextIndex);
  }, 5000);
  
  // é¼ æ ‡æ‚¬åœæš‚åœè½®æ’­
  carousel.addEventListener('mouseenter', () => {
    clearInterval(interval);
  });
  
  carousel.addEventListener('mouseleave', () => {
    interval = setInterval(() => {
      const nextIndex = (currentIndex + 1) % slides.length;
      showSlide(nextIndex);
    }, 5000);
  });
  
  // å¯¼èˆªç‚¹ç‚¹å‡»
  dots.forEach(dot => {
    dot.addEventListener('click', () => {
      clearInterval(interval);
      showSlide(parseInt(dot.dataset.index));
    });
  });
  
  // ä¸Šä¸€å¼ /ä¸‹ä¸€å¼ æŒ‰é’®
  prevBtn.addEventListener('click', () => {
    clearInterval(interval);
    const prevIndex = (currentIndex - 1 + slides.length) % slides.length;
    showSlide(prevIndex);
  });
  
  nextBtn.addEventListener('click', () => {
    clearInterval(interval);
    const nextIndex = (currentIndex + 1) % slides.length;
    showSlide(nextIndex);
  });
  
  // é˜…è¯»æ›´å¤šæŒ‰é’®äº‹ä»¶å§”æ‰˜
  carousel.addEventListener('click', (e) => {
    if (e.target.closest('.read-more')) {
      const id = e.target.closest('.read-more').dataset.id;
      showNewsDetail(id);
    }
  });
}
        
        
    // æ˜¾ç¤ºæ–°é—»è¯¦æƒ…
    async function showNewsDetail(id) {
      try {
        const newsItem = await getNewsById(id);
        const detailContent = document.getElementById('detailContent');
    
    // ç”Ÿæˆå…¬å¼€é“¾æ¥
        const publicUrl = `${window.location.origin}${window.location.pathname}?id=${id}`;
    
        detailContent.innerHTML = `
        <h1 class="news-title">${newsItem.title}</h1>
        <div class="news-meta">
        <span><i class="fas fa-calendar-alt"></i> ${formatDate(newsItem.time)}</span>
        <span><i class="fas fa-user-edit"></i> ${newsItem.editor}</span>
        <span class="category-tag">${newsItem.category}</span>
        </div>
        <div class="news-content">
        ${newsItem.content}
        </div>
        
        <div class="divider"></div>
        <div class="share-section">
        <h3><i class="fas fa-share-alt"></i> åˆ†äº«è¿™ç¯‡æ–°é—»</h3>
        <div class="share-buttons">
          <a href="https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(publicUrl)}" 
             target="_blank" class="share-btn facebook">
            <i class="fab fa-facebook-f"></i> Facebook
          </a>
          <a href="https://twitter.com/intent/tweet?url=${encodeURIComponent(publicUrl)}&text=${encodeURIComponent(newsItem.title)}" 
             target="_blank" class="share-btn twitter">
            <i class="fab fa-twitter"></i> Twitter
          </a>
          <a href="https://www.threads.net/intent/post?text=${encodeURIComponent(newsItem.title + '\n\n' + publicUrl)}" 
             target="_blank" class="share-btn instagram">
            <i class="fab fa-instagram"></i> Threads
          </a>
          <a href="https://api.whatsapp.com/send?text=${encodeURIComponent(newsItem.title + ' - ' + publicUrl)}" 
             target="_blank" class="share-btn whatsapp">
            <i class="fab fa-whatsapp"></i> WhatsApp
          </a>
          <button class="share-btn link" id="copyLinkBtn">
            <i class="fas fa-link"></i> å¤åˆ¶é“¾æ¥
          </button>
        </div>
        </div>
        `;
    
    // æ·»åŠ å¤åˆ¶é“¾æ¥åŠŸèƒ½
        document.getElementById('copyLinkBtn').addEventListener('click', () => {
          navigator.clipboard.writeText(publicUrl).then(() => {
            alert('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
          }).catch(err => {
            console.error('å¤åˆ¶å¤±è´¥:', err);
            alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶é“¾æ¥');
          });
        });
    
    // æ˜¾ç¤ºè¯¦æƒ…éƒ¨åˆ†
    document.querySelectorAll('section').forEach(el => el.classList.add('hidden'));
    document.getElementById('newsDetail').classList.remove('hidden');
  } catch (error) {
    console.error('åŠ è½½æ–°é—»è¯¦æƒ…å¤±è´¥:', error);
    alert('åŠ è½½æ–°é—»è¯¦æƒ…å¤±è´¥ï¼');
  }

      // åŠ è½½è¯„è®º
loadComments(id);

// ç»‘å®šè¯„è®ºæäº¤äº‹ä»¶
document.getElementById('submitComment').addEventListener('click', () => {
  submitComment(id);
});
}
    
    async function loadComments(newsId) {
  const commentList = document.getElementById("commentList");
  commentList.innerHTML = '<p style="color: var(--color-meta);">æ­£åœ¨åŠ è½½è¯„è®º...</p>';

  try {
    const snapshot = await db.collection("comments")
      .where("newsId", "==", newsId)
      .orderBy("time", "desc")
      .get();

    if (snapshot.empty) {
      commentList.innerHTML = '<p style="color: var(--color-meta);">æš‚æ— è¯„è®º</p>';
      return;
    }

    commentList.innerHTML = snapshot.docs.map(doc => {
      const c = doc.data();
      return `
        <div class="comment-item">
          <div>
            <span class="comment-author">${c.name || "åŒ¿å"}</span>
            <span class="comment-time">${new Date(c.time).toLocaleString('zh-CN')}</span>
          </div>
          <div class="comment-content">${c.content}</div>
        </div>
      `;
    }).join("");
  } catch (error) {
  console.error("è¯„è®ºåŠ è½½å¤±è´¥ï¼š", error);
  console.log("æ–°é—»ID:", newsId);
  console.log("é”™è¯¯ä»£ç :", error.code);
  console.log("é”™è¯¯ä¿¡æ¯:", error.message);
  
  commentList.innerHTML = `
    <p style="color: var(--color-accent);">
      <i class="fas fa-exclamation-triangle"></i> è¯„è®ºåŠ è½½å¤±è´¥: ${error.message}
      ${error.code === 'permission-denied' ? ' (æƒé™ä¸è¶³)' : ''}
    </p>
  `;
  }
    }
    

    // è¿”å›æ–°é—»åˆ—è¡¨
    function showNewsList() {
      document.querySelectorAll('section').forEach(el => el.classList.add('hidden'));
      document.getElementById('newsList').classList.remove('hidden');
    }

    



    // åˆå§‹åŒ–é¡µé¢
    async function initialize() {
      addFloatingButton();
      try {
        
        // åˆå§‹åŒ–ä¸»é¢˜
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
        const themeIcon = document.querySelector('.theme-toggle i');
        themeIcon.className = savedTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';

        // å¤„ç†URLå‚æ•°
        const params = new URLSearchParams(location.search);
        const id = params.get('id');
        
        if (id) {
          // ç›´æ¥è®¿é—®è¯¦æƒ…é¡µ
          document.querySelectorAll('section').forEach(el => el.classList.add('hidden'));
          document.getElementById('newsDetail').classList.remove('hidden');
          await showNewsDetail(id);
          role = 'guest';
          logoutBtn.classList.remove('hidden');
        } else {
          // æ˜¾ç¤ºç™»å½•ç•Œé¢
          document.querySelectorAll('section').forEach(el => el.classList.add('hidden'));
          document.getElementById('login').classList.remove('hidden');
          logoutBtn.classList.add('hidden');
        }

        // è®¾ç½®ç¼–è¾‘å™¨ä¿æŠ¤
        editor.addEventListener("blur", () => {
          if (editor.innerHTML.trim() === "") {
            editor.innerHTML = "<p><br></p>";
          }
        });
        
      } catch (error) {
        console.error("åˆå§‹åŒ–å¤±è´¥:", error);
        document.getElementById('login').innerHTML = `
          <div class="card">
            <h2 style="text-align: center; margin-bottom: 1rem;">ç³»ç»Ÿé”™è¯¯</h2>
            <p style="text-align: center; color: var(--color-accent);">
              <i class="fas fa-exclamation-triangle"></i> ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•
            </p>
            <button class="btn btn-primary full-width" onclick="location.reload()">
              <i class="fas fa-sync-alt"></i> åˆ·æ–°é¡µé¢
            </button>
          </div>
        `;
      }
    }

    function bindPinButtons() {
      document.querySelectorAll('.pin-news').forEach(btn => {
        btn.addEventListener('click', async () => {
          const id = btn.dataset.id;
          const isCurrentlyPinned = btn.classList.contains('btn-warning');
          
          const success = await togglePinNews(id, !isCurrentlyPinned);
          if (success) {
            await loadNewsForAdmin();
          } else {
            alert('ç½®é¡¶æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•');
          }
        });
      });
    }

    function addFloatingButton() {
      const floatBtn = document.createElement('div');
      floatBtn.className = 'floating-action-btn hidden';
      floatBtn.innerHTML = '<i class="fas fa-arrow-up"></i>';
      floatBtn.addEventListener('click', () => {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });
      document.body.appendChild(floatBtn);
      
      window.addEventListener('scroll', () => {
        if (window.scrollY > 300) {
          floatBtn.classList.remove('hidden');
        } else {
          floatBtn.classList.add('hidden');
        }
      });
    }
    document.getElementById('newsSearchInput').addEventListener('input', function () {
  const keyword = this.value.trim().toLowerCase();
  const newsCards = document.querySelectorAll('#newsItems .news-card');

  newsCards.forEach(card => {
    const title = card.querySelector('h3')?.textContent.toLowerCase() || "";
    const content = card.querySelector('.news-excerpt')?.textContent.toLowerCase() || "";

    if (title.includes(keyword) || content.includes(keyword)) {
      card.style.display = "flex";
      card.style.opacity = 1;
      card.style.transform = "translateY(0)";
    } else {
      card.style.display = "none";
    }
  });
});

    // ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
    function bindEventListeners() {
      // ä¸»é¢˜åˆ‡æ¢
      themeToggle.addEventListener('click', toggleTheme);
      
      // ç™»å½•æŒ‰é’®
      adminLoginBtn.addEventListener('click', showAdminLogin);
      guestLoginBtn.addEventListener('click', () => loginAs('guest'));
      
      // ç™»å‡ºæŒ‰é’®
      logoutBtn.addEventListener('click', logout);
      
      // æ¨¡æ€æ¡†æŒ‰é’®
      confirmLoginBtn.addEventListener('click', verifyAdmin);
      cancelLoginBtn.addEventListener('click', hideAdminModal);
      
      // æ–°é—»ç®¡ç†æŒ‰é’®
      newsFilter.addEventListener('change', () => loadNewsForAdmin());
      categoryFilter.addEventListener('change', () => loadNewsList());
      
      // ç¼–è¾‘å™¨æŒ‰é’®
      draftBtn.addEventListener('click', saveAsDraft);
      publishBtn.addEventListener('click', publishNews);
      
      // è¿”å›æŒ‰é’®
      backToListBtn.addEventListener('click', showNewsList);

      bindPinButtons();
      
      // å¯Œæ–‡æœ¬å·¥å…·æŒ‰é’®
      document.querySelectorAll('.tool-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const title = btn.getAttribute('title');
          if (title === 'åŠ ç²—') execCmd('bold');
          else if (title === 'æ–œä½“') execCmd('italic');
          else if (title === 'ä¸‹åˆ’çº¿') execCmd('underline');
          else if (title === 'æ— åºåˆ—è¡¨') execCmd('insertUnorderedList');
          else if (title === 'æœ‰åºåˆ—è¡¨') execCmd('insertOrderedList');
          else if (title === 'å·¦å¯¹é½') execCmd('justifyLeft');
          else if (title === 'å±…ä¸­å¯¹é½') execCmd('justifyCenter');
          else if (title === 'å³å¯¹é½') execCmd('justifyRight');
          else if (title === 'æ’å…¥å›¾ç‰‡') insertImage();
          else if (title === 'æ’å…¥é“¾æ¥') execCmd('createLink');
          else if (title === 'ç§»é™¤é“¾æ¥') execCmd('unlink');
        });
      });

      // åˆ é™¤æŒ‰é’®äº‹ä»¶ç»‘å®š
      document.querySelectorAll('.delete-news').forEach(btn => {
        btn.addEventListener('click', () => {
          deleteNews(btn.dataset.id);
        });
      });
      
      // å­—ä½“é€‰æ‹©
      document.querySelector('.font-selector').addEventListener('change', function() {
        execCmd('fontName', false, this.value);
      });
      
      // å­—å·é€‰æ‹©
      document.querySelector('.size-selector').addEventListener('change', function() {
        execCmd('fontSize', false, this.value);
      });
    }

    // æ˜¾ç¤ºæŠ•ç¨¿é¡µé¢
function showSubmissionForm() {
  document.querySelectorAll('section').forEach(el => el.classList.add('hidden'));
  document.getElementById('submitFormSection').classList.remove('hidden');
  document.getElementById('submitName').focus();
}

// ç›‘å¬å›¾ç‰‡é€‰æ‹©å¹¶é¢„è§ˆ
document.addEventListener('DOMContentLoaded', () => {
  const fileInput = document.getElementById('submitImages');
  const preview = document.getElementById('imagePreview');
  
  /******************************
 * ç¾åŒ–å›¾ç‰‡ä¸Šä¼ é¢„è§ˆåŠŸèƒ½ï¼ˆæ–°ä»£ç ï¼‰
 ******************************/
document.getElementById('submitImages').addEventListener('change', function() {
  const preview = document.getElementById('imagePreview');
  preview.innerHTML = "";
  
  const files = Array.from(this.files).slice(0, 3); // é™åˆ¶æœ€å¤š3å¼ 
  
  if (files.length === 0) return;
  
  files.forEach((file, index) => {
    if (file.size > 5 * 1024 * 1024) {
      alert(`å›¾ç‰‡ ${file.name} è¶…è¿‡5MBé™åˆ¶ï¼Œå°†ä¸ä¼šè¢«ä¸Šä¼ `);
      return;
    }
    
    const reader = new FileReader();
    reader.onload = function(e) {
      const previewItem = document.createElement('div');
      previewItem.style.position = 'relative';
      
      previewItem.innerHTML = `
        <img src="${e.target.result}" alt="é¢„è§ˆå›¾ ${index + 1}">
        <div class="image-info" style="/* æ ·å¼å·²çœç•¥ */">
          ${file.name.substring(0, 15)}${file.name.length > 15 ? '...' : ''}
          (${(file.size / 1024).toFixed(1)}KB)
        </div>
      `;
      preview.appendChild(previewItem);
    };
    reader.readAsDataURL(file);
  });
});

// æ‹–æ”¾åŠŸèƒ½ç›¸å…³ä»£ç ï¼ˆä¿æŒå®Œæ•´ç²˜è´´ï¼‰
const uploadArea = document.querySelector('.upload-area');
['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
  uploadArea.addEventListener(eventName, preventDefaults, false);
});

function preventDefaults(e) { /* ... */ }
function highlight() { /* ... */ }
function unhighlight() { /* ... */ }
function handleDrop(e) { /* ... */ }
});

    // æäº¤è¯„è®º
async function submitComment(newsId) {
  const content = document.getElementById('commentContent').value.trim();
  const name = document.getElementById('commentName').value.trim();
  const isAnonymous = document.getElementById('commentAnonymous').checked;

  if (!content) {
    alert('è¯·è¾“å…¥è¯„è®ºå†…å®¹');
    return;
  }

  try {
    await db.collection('comments').add({
      newsId,
      content,
      author: isAnonymous ? 'åŒ¿åç”¨æˆ·' : (name || 'åŒ¿åç”¨æˆ·'),
      time: new Date().toISOString()
    });

    document.getElementById('commentContent').value = '';
    document.getElementById('commentName').value = '';
    loadComments(newsId);
  } catch (error) {
    console.error('æäº¤è¯„è®ºå¤±è´¥:', error);
    alert('è¯„è®ºæäº¤å¤±è´¥ï¼Œè¯·é‡è¯•');
  }
}

// æŠ•ç¨¿æäº¤é€»è¾‘
async function submitNews() {
  const name = document.getElementById('submitName').value.trim();
  const title = document.getElementById('submitTitle').value.trim();
  const content = document.getElementById('submitContent').value.trim();
  const category = document.getElementById('submitCategory').value;

  if (!name || !title || !content) {
    alert("âš ï¸ è¯·å¡«å†™æ‰€æœ‰å¿…å¡«é¡¹ï¼");
    return;
  }

  try {
    const data = {
      name,
      title,
      content,
      category,
      time: new Date().toISOString(),
      status: 'pending'
      // ç§»é™¤äº†imageså­—æ®µ
    };

    await db.collection("submissions").add(data);
    alert("âœ… æŠ•ç¨¿æˆåŠŸï¼æˆ‘ä»¬å°†å°½å¿«å®¡æ ¸æ‚¨çš„å†…å®¹ã€‚");

    // æ¸…ç©ºè¡¨å•
    document.getElementById('submitName').value = "";
    document.getElementById('submitTitle').value = "";
    document.getElementById('submitContent').value = "";
    document.getElementById('submitImages').value = "";
    document.getElementById('imagePreview').innerHTML = "";

    showNewsList();
  } catch (error) {
    console.error("æäº¤å¤±è´¥:", error);
    alert("âŒ æŠ•ç¨¿å¤±è´¥ï¼Œè¯·ç¨åå†è¯•ï¼");
  }
}

    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    window.addEventListener('DOMContentLoaded', async () => {
      await initialize();
      bindEventListeners();
    });
  </script>
</body>
</html>
